# 5. 表面着色



当我们在3D场景下渲染图像时，无论是用光线跟踪还是光栅化，无论实时处理还是批处理，三维视觉表达的关键都是：根根据场景中表面的形状和它们与场景中其他物体的关系为其着色。在现实物理世界中，我们看到的大多数光都是反射光线，光线反射的物理特性会极大地受到几何要素的影像，然后会产生很多线索（cues），这些线索可以让人类的视觉系统非常有效的理解物体形状。

在计算机图形学中，尽管不同应用程序着色的目的可能不同，但其主要目的是为视觉系统提供线索。在计算机辅助设计或科学可视化中，着色的重要目的在于清晰度：着色应该提供最清晰、最准确的3D形状表达。另一方面，在视觉特效或广告中，其目标是最大限度地使效果图与真实物体的外观相似。在动画、虚拟环境或游戏中，其目标介于两者之间：为了达到艺术目的，包括描述形状和材料，但不一定是为了接近现实。

用于计算着色的公式被称为着色模型（shading model），不同的应用对应一系列不同的着色模型。一般来说，这些着色模型都是起源于简单的模型，为光线反射的物理特性提供了一个有效的近似表达。以简单的着色模型为基础，可以添加额外的特征，以实现更逼真的渲染效果，或者可以修改、删除一些部分，使模型更符合抽象的风格。

着色模型独立于渲染系统的其他部分，同样的模型对光线追踪和光栅化系统都适用。本章描述了点光源照射下不透明表面的基本着色模型。这个模型满足了我们的简单需求，并且也是更高级着色模型的起点，我们在第14章中会进一步讨论。



## 5.1 类点光源（point-like light sources）



在现实世界中，光线从四面八方照射到物体表面上，但为了建模光照，先做一个简单的假设：光线从单一方向上到达表面，这是一种理想情况。但是对于光源的尺寸大小相对于光源到表面距离的比例很小时，这种假设是很有用的。要么光源的确很小（比如一个LED的闪光等），要么光源确实距离非常远（比如说太阳）。类点光源分为两种情况：一种是小到可以看做是一个点（相对于它的距离）且距离场景较近的点光源（手电筒），另外一种是比较远的方向光源（太阳光）；



### 5.1.1 点光源照明

点光源的位置是三维空间中的一个点，其强度是它产生的光的大小。点光源可以是各向同性的（isotropic），也就它是在所有方向的强度是相同的，通常这也是默认设置，但很多系统提供只向特定方向发光的”聚光灯“，可以方便地控制虚拟场景中的光，就像舞台上真实的聚光灯一样。

对于各向同性的点光源，很容易推算出打在确定距离表面上的光的强度。假设我们有一个发射1瓦功率的各向同性点光源，我们把它放在一个半径为1米的空心球的中心(图5.1)。

<img src="5. 表面着色.assets/image-20220923162723577.png" alt="image-20220923162723577" style="zoom:50%;" />

<center>图5.1 来自点光源的照射强度和距离的平方成反比。</center>

所有来自点光源的能量都落在球的内表面，并且均匀地分布在4π㎡的表面积上，所以单位面积辐射能量的密度是1/(4π)瓦/平方米。这一密度被称为照射强度（irradiance），又叫做辐射通量密度。它量化的描述了有多少光打在了会发生反射的目标表面上。

在一般情况下，一个具有能量P的点光源，打在半径为r的球的内表面上，则照度E为：
$$
E=\frac{P}{4π}\frac{1}{r^2}=\frac {I}{r^2}\tag{5.1}
$$
$I=P/(4π)$表示光源的光照强度。上面公式是光源本身的性质，与被照射的物体表面无关。因子$r^{-2}$也叫做平方反比系数，描述了照射强度大小与光源到表面距离r的关系。

计算照射强度时另一个要考虑的因素是照射角度（angle of incidence）——表面法线和光线方向之间的角度是变化的。考虑一个微小表面受到来自远处的一个点光源的照射，光可以照射到整个微小表面上，光线大致是平行的。如果我们将表面倾斜60°（如图5.2），表面只会接收到一半的光。通常将表面旋转一个角度θ意味着接收光的比例为变为cosθ，因为区域位置保持不变，所以整个的比例直接乘上这个因子。

<img src="5. 表面着色.assets/image-20220923164757431.png" alt="image-20220923164757431" style="zoom:50%;" />

<center>图5.2 （a）一束光打在整个立方体上面。（b）当立方体倾斜60°后，只有一半的光打在立方体上，由于总面积没变，所以单位面积的能量，或者光照强度也随之减半。</center>