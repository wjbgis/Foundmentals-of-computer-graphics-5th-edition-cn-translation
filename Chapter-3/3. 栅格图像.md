# 3. 光栅图像



计算机中的大多数图像都是以光栅/栅格（raster）的形式展现给用户的——将图像显示为由像素组成的矩阵阵列。最常见的例子是平板电脑或电视，它们的屏幕是由一个个发光的小像素组成的矩形阵列，可以单独为屏幕的每个像素设置不同的颜色，通过混合不同强度的红、绿、蓝光生成不同的颜色，以用来随心所欲地创建图像。大多数打印机，如激光打印机和喷墨打印机，也是光栅图像设备。它们基于扫描生成图像， 虽然没有像素的物理网格，但图像是通过在顺序排列的网格特定的位置沉积墨水生成的。

光栅在图像输入设备中也很常见。数码相机包含一个由光敏像素组成的图像传感器，每个像素会记录落在它上面的光的颜色和强度。台式扫描仪包含一个线性的像素阵列，当它扫描页面时，每秒会进行多次测量以生成相应的像素。

由于光栅设备的普遍应用，栅格也就成了最常见的存储和处理图像的格式。光栅图像是一个2D数组，数组中的元素存储每个像素的值——通常存储为三个数字，分别代表红色、绿色和蓝色。我们可以使用图像中的每个像素值来控制显示器对应像素的颜色，进而显示出该栅格图像。

但只是这样显示图像并不能满足我们的需求。我们可能想更改图像的大小、方向、颜色，甚至想把图像贴在一个运动的三维物体上。即使在电视上，显示器的像素数量也很少与被显示图像的像素数量完全相同。这些情况会破坏图像像素和显示像素之间的直接联系，所以最好将栅格图像视为与显示设备无关的对象，而显示设备则是展示接近理想图像的一种方式。

除了使用像素数组之外，当然还有其它描述图像的方式。矢量图像（vector image）存储了对图像的描述——以线条为界的彩色区域——而不涉及任何特定的像素网格。本质上，这相当于存储图像的说明，而不是图像所需的像素。矢量图像的最大优点是它们与分辨率无关，可以在高分辨率的设备上高质量的显示图像；但它们的缺点是必须栅格化后才能进行显示。矢量图像常用于文本、图表、机械制图等，在这些情况下，最重要的是清晰度和精度，不需要照片影像和复杂的着色。

本章我们讨论栅格图像及其显示的基础知识，特别注意标准显示的非线性，在以后的章节中讨论图像计算时，像素值和光线强度的关系是很重要的。



## 3.1 光栅设备



在抽象化讨论栅格图像之前，有必要先看下使用这些图像的某些特定设备的基本操。我们熟悉的光栅设备可以分为如下简单的层次结构:

* 输出
  * 显示器
    * 透射式：液晶显示器（LCD）
    * 发射式：发光二极管（LED）
  * 打印机
    * 二进制：喷墨打印机
    * 连续色调:染料升华打印机
* 输入
  * 二维阵列传感器：数码相机
  * 一维阵列传感器：平板扫描仪

### 3.1.1 显示器

目前的显示器（电视、电脑显示器、投影仪等）普遍是由固定的像素阵列组成的。它们可以被分为发射式显示器和透射式显示器，前者使用像素直接发射一定数量的光，后者的像素本身不发射光，而是可以改变允许通过的光的数量。透射式显示器需要光源来照亮它们:在直接观看的显示器中，光源是阵列的背光；在投影仪中，光源是发光的灯，光穿过阵列后投射到屏幕上。发射式显示器本身就是光源。

发光二极管（LED）显示器就是典型的发射式显示器，每个像素由一到多个发光二极管（一种半导体器件）组成，光的亮度取决于通过LED的电流（图3.1）。

<img src="./3. 栅格图像.assets/image-20220908144111566.png" alt="image-20220908144111566" style="zoom: 50%;" />

<center>图3.1 LED屏幕的显示原理</center>

彩色显示器中的像素被分为红、绿、蓝三个独立控制的子像素（subpixel），每个子像素都有自己的使用不同材料的LED，以便发出不同颜色的光（图3.2）。当我们从远处看LED屏幕时，眼睛无法分辨单独的子像素的颜色，而是看到红绿蓝三种颜色的混合色。

<img src="./3. 栅格图像.assets/image-20220908144938291.png" alt="image-20220908144938291" style="zoom: 50%;" />

<center>图3.2 LED显示器一个像素内的红绿蓝子像素</center>

液晶显示器（LCD）是典型的透射式显示器。液晶是一种材料，其分子结构使穿过它的在光偏振方向发生旋转，旋转的程度可以通过施加的电压来调整。一个液晶像素(图3.3)后面有一层偏振光膜，因此它被偏振光照亮（假设是水平偏振光）。

<img src="./3. 栅格图像.assets/image-20220908145917241.png" alt="image-20220908145917241" style="zoom:50%;" />

<center>图3.3 液晶显示器的一个像素的关闭状态(下)和打开状态(上)；在关闭状态时，前偏振片挡住了所有通过后偏振片的光；在打开状态时，液晶单元旋转偏振片使光通过前偏振片。图由Erik Reinhard提供(Reinhard, Khan, Akyüz,& Johnson, 2008)。</center>

位于前面的第二层偏振片只透射垂直偏振光。如果施加的电压设置为使中间的液晶层不改变偏振，则所有的光都会被挡住，像素处于“关闭”(最小强度)状态。如果将电压设置为液晶将偏振旋转90度，那么所有从像素背面进入的光将从正面逃逸，像素完全“打开”（最大强度）。中等强度的电压将部分旋转偏振，使得光被部分遮挡，导致光强度介于最小和最大之间(图3.4)。

<img src="./3. 栅格图像.assets/image-20220908163013206.png" alt="image-20220908163013206" style="zoom:50%;" />

<center>图3.4 液晶显示器显示原理</center>

与彩色LED显示器类似，彩色LCD显示器在每个像素内也有红、绿和蓝子像素，这是三个独立的像素，子像素上面有红、绿和蓝滤色器。

任何具有固定像素格子的显示器，其固定分辨率都是由格子大小决定的。对于显示器和图像，分辨率仅仅意味着像素网格的尺寸：如果显示器的分辨率是1920 × 1200像素，这意味着它共有2,304,000个像素，依次排列在1920列和1200行的网格中。

如果一个图像的分辨率和该屏幕的分辨率不同，要使该图像填满屏幕，则必须将其转换到1920 × 1200的分辨率 ，该方法将在第9章介绍。

### 3.1.2 打印设备

在纸张上永久地记录图像与在显示器上暂时显示图像有很大的不同。印刷的颜料分布在纸张或其他介质上，当这些颜料对光线形成反射时，我们就看到了介质上的图像。和显示器一样，打印机也是光栅设备，但许多打印机只能打印二进制图像——颜料要么沉积要么不沉积在某个位置，不可能有中间状态。喷墨打印机是通过扫描形成光栅图像的设备(图3.5)。喷墨打印头含有携带颜料的液体墨水，可以在电子控制下以非常小的滴状喷射。打印机头部在纸上移动，当它经过应该接收墨水的网格位置时，水滴就会发射出来，应该保持空白的区域不喷射墨水。每次扫完一行后，纸张稍微向前移动，然后将下一行相应的格子打印出来。彩色打印是用有多个打印头，每个打印头用不同的颜料喷洒墨水，这样每个网格位置都可以收到不同颜色任意组合的墨水。因为所有的墨水滴都是一样的，喷墨打印机打印二进制图像：在每个网格点有或没有墨水；没有中间状态。

<img src="./3. 栅格图像.assets/image-20220908165355853.png" alt="image-20220908165355853" style="zoom: 50%;" />

<center>图3.5 喷墨打印机工作原理</center>

喷墨打印机没有依次排列的像素阵列，印结果是由水滴大小和纸张每次的前进距离决定的。许多喷墨打印机的打印头有多个喷嘴，这使得一次扫描可以打印多行，但最终决定行间距的是纸张的前进速度，而不是喷嘴的间距。

热敏染料转移过程是连续色调印刷的一个例子，和喷墨打印机不同，该技术使得每个像素都可以沉积不同数量的染料（图3.6）。在纸张和包含加热元件打印头之间压下含有彩色染料的施主色带，图像中的每个像素都受到了加热原件的作用。当纸和色带经过头部时，加热元件会打开或关闭，在需要染料的地方加热色带，使染料从色带扩散到纸上，这一过程对每种染料都要重复。温度越高，被转移的染料就越多，所以每个网格位置上沉积的每种染料的数量可以用温度来控制，从而可以产生连续的颜色变化。打印头中的加热元件的数量在整个页面的横向上建立了固定的分辨率，但沿着页面纵向的分辨率是由加热和冷却的速度与纸张的移动速度相比较决定的。

<img src="./3. 栅格图像.assets/image-20220908171821305.png" alt="image-20220908171821305" style="zoom:50%;" />

<center>图3.6 热染料转印机的原理</center>

与显示器不同，打印机的分辨率是由像素密度决定的。如果一个热敏染料打印机的打印头每英寸有300个元素，那么它在整个页面上的分辨率是每英寸300个像素(ppi)。如果选择页面上的分辨率相同，我们可以简单地说打印机的分辨率是300 ppi。在每英寸1200格点的网格上放置点的喷墨打印机被称为分辨率为每英寸1200点(dpi)。因为喷墨打印机是二进制设备，它需要更精细的网格，至少有两个原因：一是因为边缘是突兀的黑白边界，所以需要很高的分辨率来避免出现阶梯状或走样(见9.3节)。二是当打印连续色调的图像时，需要高分辨率来模拟中间色，打印密度变化的网点图案，也叫做半色调。

>dpi指代每英寸像素，但dpi应该用于描述二进制设备，ppi用于描述连续色调设备

### 3.1.3 输入设备

栅格图像需要有来源，任何没有通过某种算法计算出来的图像都必须通过一些栅格输入设备来获取，最常见的获取设备是相机或扫描仪。即使在渲染3D场景时，也会用到照片作为纹理贴图(见第11章)。光栅输入设备必须对每个像素进行光照测量，并且(像输出设备一样)它们通常基于传感器阵列获取影像。数码相机是一个二维阵列输入设备，相机中的图像传感器是一种具有光敏像素网格的半导体器件。两种常见的传感器阵列有CCD(电荷耦合器件)和CMOS(互补金属氧化物半导体)。相机的镜头将要拍摄的场景的图像投射到传感器上，然后每个像素测量落在它上面的光能，最终产生一个进入输出图像的数值(图3.7)。就像彩色显示器使用红、绿、蓝子像素一样，大多数彩色相机使用滤色镜阵列或马赛克来让每个像素只看到红、绿或蓝色的光，然后让图像处理软件填补缺失的值，这一过程叫做“去马赛克”（demosaicking）(图3.8)。

<img src="./3. 栅格图像.assets/image-20220908174935317.png" alt="image-20220908174935317" style="zoom:67%;" />

<center>图3.7 数码相机原理</center>

<img src="./3. 栅格图像.assets/image-20220908175433694.png" alt="image-20220908175433694" style="zoom:67%;" />

<center>图3.8 大多数彩色数码相机使用类似”拜耳马赛克“（Bayer mosaic）的滤镜阵列。每个像素用于测量红光、绿光或蓝光。</center>

其他相机（非数码相机）使用三个独立的阵列，或阵列中有三个独立层，在每个像素测量独立的红、绿、蓝的值，生成一个有效的彩色图像，而无需进一步处理。相机的分辨率是由阵列中固定的像素数决定的，通常使用像素总数来表示：具有3000列和2000行像素的相机获取的图像分辨率为3000 × 2000，它有600万像素。重要的是要记住，马赛克传感器不能测量完整的彩色图像，因此，相同像素数的情况下，使用独立的红、绿、蓝测量的相机比使用马赛克传感器的相机能记录更多关于图像的信息。

平板扫描仪也可以测量每个像素网格的红、绿、蓝数值，但与热染料转移打印机一样，它使用的是一维阵列，可以在页面上进行扫描，每秒进行多次测量。整个页面的横向分辨率由阵列的大小决定，而整个页面的分辨率是由测量频率与扫描头移动速度共同决定的。彩色扫描仪有一个3 × $n_x$数组，其中$n_x$是横向的像素数，三行被红色、绿色和蓝色过滤器覆盖。在测量三种颜色的时间之间有一个适当的延迟，这允许在每个网格点进行三次独立的颜色测量。与连续色调打印机一样，扫描仪的分辨率以每英寸像素(ppi)来描述的。

<img src="3. 栅格图像.assets/image-20220909171139650.png" alt="image-20220909171139650" style="zoom:50%;" />

<center>图3.9 平板扫描仪的操作</center>

知道了图像来自哪里以及去向何处，现在我们将以我们在图形学算法中使用它们的方式更抽象地讨论图像。



## 3.2 图像、像素和几何图形



我们知道栅格图像是是一个大的像素矩阵，每个像素存储着该格网点的颜色信息。我们也了解了各种输出设备如何处理我们发送给它们的图像，以及输入设备如何从光线反射回来的物理世界中获取图像。但于计算机而言，我们需要对图像抽象化，这种抽象不依赖设备的各种细节，我们可以用它来推论如何产生或说明存在图像中的信息。

当测量或重现图像时，它们以光能的二维分布形式出现：从显示器发出的光是关于显示器表面位置的函数；落在相机图像传感器上的光是关于传感器平面位置上的函数；反射率或光被反射的部分（相对于被吸收的部分）是关于纸张位置的函数。在现实世界中，图像是定义在二维区域（多数是矩形区域）上的函数。因此我们可以把图像抽象成如下函数：
$$
I(x,y) : R → V,
$$
其中R表示一个矩形区域，$R⊂ℝ^2$ ；V表示一个像素值集合。最简单的例子是一个理想的灰度图像，矩形中的点只有亮度(没有颜色)，这使我们可以说$V=ℝ^+$（非负实数）。对于一个理想化的彩色图像，每个像素都有红、绿、蓝三个值，此时$V=(ℝ^+)^3$。我们将在下一节讨论V的其它可能取值。

>*译者注：符号 ℝ 表示实数*，$ℝ^2:=\{(x,y) | x,y∈ℝ\}$ ，同理$ℝ^3:=\{(x,y,z) | x,y,z∈ℝ\}$

光栅图像与这个抽象概念有什么关系？接下来看具体例子：一个像素的值，是相机或扫描仪通过测量该像素周围小区域的平均颜色得到的；一个显示器的像素拥有有红、绿、蓝三个子像素，使图像像素的平均颜色由光栅图像中相应的像素值控制。在这两种情况下，像素值都是图像颜色的局部平均值，也称为图像的点采样。换句话说，当我们在一个像素中找到 x 这个值时，意味着“图像在这个网格点附近的值为x”。图像作为函数的抽样表示，这一思想将在第9章中进一步探讨。

还有一个不起眼但重要的问题是：像素在2D空间中的位置。像素的位置描述是一个约定俗成的准则，有这样一个准则是很重要的！在本书中，采用像素行列号 (i , j) 来索引栅格图像，行列号的起点为图像的左下角。如果一幅图像有$n_x$列和$n_y$行像素，则其左下角的像素索引为(0,0)，右上像素索引为$(n_x-1, n_y-1)$。我们需要2D真实屏幕坐标来指定像素位置。我们将像素的采样点放在整数坐标位置上，如图3.10 中4 × 3大小的屏幕所示。

<img src="3. 栅格图像.assets/image-20220909141919865.png" alt="image-20220909141919865" style="zoom: 33%;" />

<center>图3.10 一个4×3像素大小的屏幕，注意在一些API中，y轴是向下的</center>

由于$(n_x,n_y)$在网格的中心，也就是说，整个矩形每一侧的最后一个采样点都会向外扩展半个像素。所以一个$n_x×n_y$大小的图像，其空间范围是：
$$
R=[-0.5,n_x-0.5]×[-0.5,n_y-0.5]
$$
同样，这些坐标只是简单的约定，它们在以后实现相机和视图的转换时是很重要的。



### 3.2.1 像素值

我们用实数来描述像素的取值，该值表示图像中某一点的强度（可能分别表示红色、绿色和蓝色）。也就是说整个图像本身是一个浮点数数组，图像中的每个像素存储一个（用于灰度或黑白图像）或三个（用于RGB彩色图像）32位（32-bit）浮点数。这种格式在需要获取像素的精度和取值范围时是有必要的，但一张图像通常会有很多像素，我们用于存储图像的内存和用于传输图像的带宽是有限的。在这种格式下，一张仅1000万像素的照片就有115MB那么大。

我们需要占用内存更少的图片以满足显示的需求。虽然光的强度在原则上是可以无限大的，但任何设备的光线都有一个最大强度限制，所以在许多情况下，像素取值在一个有限的范围内就够了，通常为了简单起见，在区间[0,1]内取值。例如，8-bit（8-bit）图像中的像素可能取值是0，1/255，2/255，…，254/255， 1。使用浮点数存储的图像允许大范围取值，通常被称为高动态范围(HDR)图像，以区别于使用整数存储的固定范围或低动态范围(LDR)图像。本书第20章将会深入讨论HDR相关技术和应用。

以下是一些常见的像素格式:

* 1-bit 灰度图——文本或其他不需要中间灰度的图像(需要高分辨率)；
* 8-bit 固定范围RGB图片（每像素24位），是互联网和电子邮件中常用的图片；
* 8或10-bit 固定范围RGB图片（24或30位/像素），计算机显示器的数字接口；
* 12-14-bit 固定范围RGB图片（36-42位/像素），专业相机的原始图像；
* 16-bit 固定范围RGB图片（48位/像素），专业摄影、印刷；用于处理固定范围图像的中间格式；
* 16-bit 固定范围灰度图片（16位/像素），放射和医学成像；
* 16-bit “半精度”浮点RGB-HDR图像；实时渲染的中间格式；
* 32-bit 浮点RGB图片，用于HDR图像渲染和处理。

减少用于存储每个像素的位数（bit）会导致两种不同类型的伪影，或者会在图像中引入缺陷。首先，当设置了比最大值更亮的像素时，使用固定范围编码图像时会产生剪切。例如，一张阳光下的照片可能包含比白色表面更明亮的反射；当图像转换到一个固定的范围显示时，这些将被剪切掉(即使它们是由相机测量的)。其次，当对像素值四舍五入时，固定范围编码的图像将产生伪影或条带，从而导致可见的强度或颜色跳跃。在动画和视频中，当图像静止时，条带可能特别隐蔽，但在非静止画面中它们会来回移动，就会让人非常反感。



### 3.2.2 显示器的强度和伽马值

当今所有的显示器都是以数字的方式输入像素值，并将其转换为相应的强度级别。因为屏幕会反光，所以显示器在关闭状态下有会一些非零强度。为了更好地说明，我们可以将关闭的显示器视为“黑色”，完全打开的显示器视为“白色”。我们假设像素值得范围是0到1，黑色是0，白色是1，介于黑白之间的灰色是0.5。注意，这里的“介于黑白之间”指的是来自像素的物理光量，而不是外观。人类对强度的感知是非线性的，详见第19章。

要在显示器上生成正确的图像，必须明白两个关键问题。

第一个问题是，显示器与输入的图像是非线性的相关的。例如，如果你给显示器输入三个像素，它们的值分别为0，0.5和1，而显示出来的的强度可能是0、0.25和1.0(关闭、四分之一完全打开和完全打开)。作为这种非线性的近似表征，监视器通常由 γ（“伽马”）值表征。这个值就是下面公式中的自由度：
$$
显示强度=(最大强度)a^γ\tag{3.1}
$$
其中a为输入的像素值，取值在0到1之间。例如，如果显示器的 γ 值为2.0，而我们输入的值a = 0.5，则显示的强度将是最大强度的四分之一，因为$0.5^2=0.25$。显而易见，当a=0或1时，显示强度不受 γ 值的影响。用 γ 描述显示设备的非线性仅仅是一个近似值，我们不需要很精确地计算一个设备的γ值。估算非线性的一个很好的视觉方法是，找到介于显示器黑白强度中间值所对应的a，a满足如下关系：
$$
0.5=a^γ
$$
如果我们能找到这个a，我们就可以通过对两边取对数来推导γ：
$$
γ=\frac{ln0.5}{ln a}
$$
我们可以通过一种标准的技术找到a，即在输入a的灰度像素旁边显示一个黑白像素的棋盘图案(图3.11)，然后让用户手动调整(比如用滑块)，直到两边的平均亮度一致。当你从远处(或者如果你是近视眼，不戴眼镜)看这幅图像时，当a产生介于黑白网格之间的强度时，左右两边看起来是相同的。这是因为模糊的棋盘是混合偶数个黑、白像素的混合体，所以整体呈现效果是一个介于黑色和白色之间的颜色。

<img src="3. 栅格图像.assets/image-20220909170914427.png" alt="image-20220909170914427" style="zoom: 50%;" />

<center>图3.11 从远处看，交替的黑白像素介于黑白之间。可以通过找到一个与黑白网格相近的强度值来推断显示器的伽玛值。</center>

一旦我们知道了γ，我们就可以对输入进行*伽马校正*，使 a = 0.5 的值以在显示时强度介于黑白之间。这是通过如下变换来实现：
$$
a'=a^\frac{1}{γ}
$$
将此公式代入式(3.1)，得到:
$$
显示强度=a'^γ=(a^\frac{1}{γ})^γ(最大强度)=a(最大强度)
$$
真实显示器的另一个重要特征是它们采用量化的输入值。因此，虽然我们可以在浮点范围 [0, 1] 内操作强度，但显示器的详细输入是一个固定大小的整数。这个整数最常见的范围是0-255，可以保存在8位存储器中。这意味着 a 的可能值不是 [0, 1] 中的任何数字，而是：
$$
a=\{\frac{0}{255},\frac{1}{255}...,\frac{254}{255},\frac{255}{255}\}
$$
这意味着显示器显示的强度值约为：
$$
\{M(\frac{0}{255})^γ,M(\frac{1}{255})^γ...,M(\frac{254}{255})^γ,M(\frac{255}{255})^γ\}
$$
其中，M表示最大强度值。在需要控制精确强度的应用中，我们必须实际测量 256 种可能的强度，这些强度在屏幕上的不同点可能有所不同。尤其是对于 CRT， 它们也可能因视角而异，幸运的是，很少有应用需要如此精确的精度。



## 3.3 RGB 颜色



大多数计算机图形图像是根据红绿蓝 (RGB) 三原色来渲染的。在本节中，为方便起见，我们从用户的角度讨论RGB颜色，在第19章将对颜色进行进一步讨论。**RGB颜色空间**的构成机制使得编写图形学程序更加方便，其的基本思想是，通过红、绿、蓝三种主要光源的混合来显示不同的颜色。颜色通过*加色*的方式进行混合。

颜色混合规则为（图3.12）：
$$
红色+绿色=黄色，\\

绿色+蓝色=青色（cyan），\\

蓝色+红色=品红色（magenta），\\

红色+绿色+蓝色=白色。
$$
<img src="3. 栅格图像.assets/image-20220911102016382.png" alt="image-20220911102016382" style="zoom:50%;" />

<center>图3.12 红绿蓝加色法则</center>

“青色”是一种蓝绿色，“品红”是一种紫色。

如果主光源的允许调整范围是从完全关闭(由像素值0表示)到完全打开(由像素值1表示)，那我们可以在RGB显示器上创建所有的颜色。以红、绿和蓝像素值为坐标轴可以创建出一个三维RGB颜色立方体，坐标轴的取值范围是0到1（图3.13）。

<img src="3. 栅格图像.assets/image-20220911103304840.png" alt="image-20220911103304840" style="zoom:50%;" />

<center>图3.13 RGB颜色立方体及其展开形式，任何RGB颜色都是立方体中的一个点</center>

立方体角点对应的颜色分别为：

黑色 = (0, 0, 0)，

红色 = (1, 0, 0)，

绿色 = (0, 1, 0)， 

蓝色 = (0, 0, 1)，

黄色 = (1, 1, 0)， 

品红色 = (1, 0, 1)，

青色 = (0, 1, 1)，

白色 = (1, 1, 1)。

如3.2.2节中讨论的灰度一样，实际上RGB通常以量化的形式给出。RGB的每个分量都用整数描述，通常每个整数只占用一个字节，所以三个RGB分量都是0到255之间的整数。因此，一个具有“24-bit 颜色”的系统中三原色的每一个都有256种可能。第3.2.2节中讨论的伽马校正问题也分别适用于每个RGB分量。



## 3.4 Alpha 合成



有时我们经常碰到像素的覆盖。比如说在图像合成时，我们有一个背景图像，然后希望在其上插入前景图像；对于前景中不透明的像素，我们只需要替换相应的背景像素；对于前景图像完全透明的部分，我们无须改变背景像素；我们需要注意的是前景中部分透明的像素。当前景中出现诸如玻璃这种部分透明的区域时，相应的像素就需要做部分透明处理。还有最常见的情形是前景和背景像素的混合，比如前景对象仅部分覆盖背景对象，或者在前景对象的边缘处，再或者出现亚像素孔洞（sub-pixel hole）时（比如树叶之间的空隙）。

将前景对象与背景对象混合所需要最重要的信息是像素覆盖范围，它表示一个像素被前景图层覆盖的比例，记作α。如果在一个像素上要将前景色$c_f$和背景色$c_b$合成，该像素上前景覆盖的比例为α，则合成颜色公式为：
$$
c=αc_f+(1-α)c_b \tag{3.2}
$$
若前景图层不透明，该公式可理解为：前景像素覆盖背景像素的比例为α，背景像素未被覆盖的比例为(1-α)；若前景图层透明，该公式可理解为：前景像素吞并了（注：原文是阻碍（block），但个人认为翻译为吞并比较好理解）部分透过背景像素的光，吞并的比例为α，未被吞并的比例为(1-α)，前景像素贡献了α比例的自身颜色，用于代替被吞并掉的背景颜色。图3.14对公式3.2进行了进一步解释：

<img src="3. 栅格图像.assets/image-20220911120437198.png" alt="image-20220911120437198" style="zoom: 33%;" />

<center>图3.14 前景图像在被放到背景图像的上面之前，实际上是被α通道裁剪的。底部的图是合成结果。
</center>



### 3.4.1 图像存储

