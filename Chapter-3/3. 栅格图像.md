# 3. 光栅图像



计算机中的大多数图像都是以光栅/栅格（raster）的形式展现给用户的——将图像显示为由像素组成的矩阵阵列。最常见的例子是平板电脑或电视，它们的屏幕是由一个个发光的小像素组成的矩形阵列，可以单独为屏幕的每个像素设置不同的颜色，通过混合不同强度的红、绿、蓝光生成不同的颜色，以用来随心所欲地创建图像。大多数打印机，如激光打印机和喷墨打印机，也是光栅图像设备。它们基于扫描生成图像， 虽然没有像素的物理网格，但图像是通过在顺序排列的网格特定的位置沉积墨水生成的。

光栅在图像输入设备中也很常见。数码相机包含一个由光敏像素组成的图像传感器，每个像素会记录落在它上面的光的颜色和强度。台式扫描仪包含一个线性的像素阵列，当它扫描页面时，每秒会进行多次测量以生成相应的像素。

由于光栅设备的普遍应用，栅格也就成了最常见的存储和处理图像的格式。光栅图像是一个2D数组，数组中的元素存储每个像素的值——通常存储为三个数字，分别代表红色、绿色和蓝色。我们可以使用图像中的每个像素值来控制显示器对应像素的颜色，进而显示出该栅格图像。

但只是这样显示图像并不能满足我们的需求。我们可能想更改图像的大小、方向、颜色，甚至想把图像贴在一个运动的三维物体上。即使在电视上，显示器的像素数量也很少与被显示图像的像素数量完全相同。这些情况会破坏图像像素和显示像素之间的直接联系，所以最好将栅格图像视为与显示设备无关的对象，而显示设备则是展示接近理想图像的一种方式。

除了使用像素数组之外，当然还有其它描述图像的方式。矢量图像（vector image）存储了对图像的描述——以线条为界的彩色区域——而不涉及任何特定的像素网格。本质上，这相当于存储图像的说明，而不是图像所需的像素。矢量图像的最大优点是它们与分辨率无关，可以在高分辨率的设备上高质量的显示图像；但它们的缺点是必须栅格化后才能进行显示。矢量图像常用于文本、图表、机械制图等，在这些情况下，最重要的是清晰度和精度，不需要照片影像和复杂的着色。

本章我们讨论栅格图像及其显示的基础知识，特别注意标准显示的非线性，在以后的章节中讨论图像计算时，像素值和光线强度的关系是很重要的。



## 3.1 光栅设备



在抽象化讨论栅格图像之前，有必要先看下使用这些图像的某些特定设备的基本操。我们熟悉的光栅设备可以分为如下简单的层次结构:

* 输出
  * 显示器
    * 透射式：液晶显示器（LCD）
    * 发射式：发光二极管（LED）
  * 打印机
    * 二进制：喷墨打印机
    * 连续色调:染料升华打印机
* 输入
  * 二维阵列传感器：数码相机
  * 一维阵列传感器：平板扫描仪

### 3.1.1 显示器

目前的显示器（电视、电脑显示器、投影仪等）普遍是由固定的像素阵列组成的。它们可以被分为发射式显示器和透射式显示器，前者使用像素直接发射一定数量的光，后者的像素本身不发射光，而是可以改变允许通过的光的数量。透射式显示器需要光源来照亮它们:在直接观看的显示器中，光源是阵列的背光；在投影仪中，光源是发光的灯，光穿过阵列后投射到屏幕上。发射式显示器本身就是光源。

发光二极管（LED）显示器就是典型的发射式显示器，每个像素由一到多个发光二极管（一种半导体器件）组成，光的亮度取决于通过LED的电流（图3.1）。

<img src="./3. 栅格图像.assets/image-20220908144111566.png" alt="image-20220908144111566" style="zoom: 50%;" />

<center>图3.1 LED屏幕的显示原理</center>

彩色显示器中的像素被分为红、绿、蓝三个独立控制的子像素（subpixel），每个子像素都有自己的使用不同材料的LED，以便发出不同颜色的光（图3.2）。当我们从远处看LED屏幕时，眼睛无法分辨单独的子像素的颜色，而是看到红绿蓝三种颜色的混合色。

<img src="./3. 栅格图像.assets/image-20220908144938291.png" alt="image-20220908144938291" style="zoom: 50%;" />

<center>图3.2 LED显示器一个像素内的红绿蓝子像素</center>

液晶显示器（LCD）是典型的透射式显示器。液晶是一种材料，其分子结构使穿过它的在光偏振方向发生旋转，旋转的程度可以通过施加的电压来调整。一个液晶像素(图3.3)后面有一层偏振光膜，因此它被偏振光照亮（假设是水平偏振光）。

<img src="./3. 栅格图像.assets/image-20220908145917241.png" alt="image-20220908145917241" style="zoom:50%;" />

<center>图3.3 液晶显示器的一个像素的关闭状态(下)和打开状态(上)；在关闭状态时，前偏振片挡住了所有通过后偏振片的光；在打开状态时，液晶单元旋转偏振片使光通过前偏振片。图由Erik Reinhard提供(Reinhard, Khan, Akyüz,& Johnson, 2008)。</center>

位于前面的第二层偏振片只透射垂直偏振光。如果施加的电压设置为使中间的液晶层不改变偏振，则所有的光都会被挡住，像素处于“关闭”(最小强度)状态。如果将电压设置为液晶将偏振旋转90度，那么所有从像素背面进入的光将从正面逃逸，像素完全“打开”（最大强度）。中等强度的电压将部分旋转偏振，使得光被部分遮挡，导致光强度介于最小和最大之间(图3.4)。

<img src="./3. 栅格图像.assets/image-20220908163013206.png" alt="image-20220908163013206" style="zoom:50%;" />

<center>图3.4 液晶显示器显示原理</center>

与彩色LED显示器类似，彩色LCD显示器在每个像素内也有红、绿和蓝子像素，这是三个独立的像素，子像素上面有红、绿和蓝滤色器。

任何具有固定像素格子的显示器，其固定分辨率都是由格子大小决定的。对于显示器和图像，分辨率仅仅意味着像素网格的尺寸：如果显示器的分辨率是1920 × 1200像素，这意味着它共有2,304,000个像素，依次排列在1920列和1200行的网格中。

如果一个图像的分辨率和该屏幕的分辨率不同，要使该图像填满屏幕，则必须将其转换到1920 × 1200的分辨率 ，该方法将在第9章介绍。

### 3.1.2 打印设备

在纸张上永久地记录图像与在显示器上暂时地显示图像有很大的不同。印刷的颜料分布在纸张或其他介质上，当这些颜料对光线形成反射时，我们就看到了介质上的图像。和显示器一样，打印机也是光栅设备，但许多打印机只能打印二进制图像——颜料要么沉积要么不沉积在某个位置，不可能有中间状态。喷墨打印机是通过扫描形成光栅图像的设备(图3.5)。喷墨打印头含有携带颜料的液体墨水，可以在电子控制下以非常小的滴状喷射。打印机头部在纸上移动，当它经过应该接收墨水的网格位置时，水滴就会发射出来，应该保持空白的区域不喷射墨水。每次扫完一行后，纸张稍微向前移动，然后将下一行相应的格子打印出来。彩色打印是用有多个打印头，每个打印头用不同的颜料喷洒墨水，这样每个网格位置都可以收到不同颜色任意组合的墨水。因为所有的墨水滴都是一样的，喷墨打印机打印二进制图像：在每个网格点有或没有墨水；没有中间状态。

<img src="./3. 栅格图像.assets/image-20220908165355853.png" alt="image-20220908165355853" style="zoom: 50%;" />

<center>图3.5 喷墨打印机工作原理</center>

喷墨打印机没有依次排列的像素阵列，印结果是由水滴大小和纸张每次的前进距离决定的。许多喷墨打印机的打印头有多个喷嘴，这使得一次扫描可以打印多行，但最终决定行间距的是纸张的前进速度，而不是喷嘴的间距。

热敏染料转移过程是连续色调印刷的一个例子，和喷墨打印机不同，该技术使得每个像素都可以沉积不同数量的染料（图3.6）。在纸张和包含加热元件打印头之间压下含有彩色染料的施主色带，图像中的每个像素都受到了加热原件的作用。当纸和色带经过头部时，加热元件会打开或关闭，在需要染料的地方加热色带，使染料从色带扩散到纸上，这一过程对每种染料都要重复。温度越高，被转移的染料就越多，所以每个网格位置上沉积的每种染料的数量可以用温度来控制，从而可以产生连续的颜色变化。打印头中的加热元件的数量在整个页面的横向上建立了固定的分辨率，但沿着页面纵向的分辨率是由加热和冷却的速度与纸张的移动速度相比较决定的。

<img src="./3. 栅格图像.assets/image-20220908171821305.png" alt="image-20220908171821305" style="zoom:50%;" />

<center>图3.6 热染料转印机的原理</center>

与显示器不同，打印机的分辨率是根据像素密度来描述的。如果一个热敏染料转移打印机的打印头每英寸有300个元素，那么它在整个页面上的分辨率是每英寸300个像素(ppi)。如果选择页面上的分辨率相同，我们可以简单地说打印机的分辨率是300 ppi。在每英寸1200格点的网格上放置点的喷墨打印机被称为分辨率为每英寸1200点(dpi)。因为喷墨打印机是二进制设备，它需要更精细的网格，至少有两个原因：一是因为边缘是突兀的黑白边界，所以需要很高的分辨率来避免出现阶梯状或走样(见9.3节)。二是当打印连续色调的图像时，需要高分辨率来模拟中间色，打印密度变化的网点图案，也叫做半色调。

>dpi指代每英寸像素，但dpi应该用于描述二进制设备，ppi用于描述连续色调设备

### 3.1.3 输入设备

栅格图像需要有来源，任何没有通过某种算法计算出来的图像都必须通过一些栅格输入设备来获取，最常见的获取设备是相机或扫描仪。即使在渲染3D场景时，也会用到照片作为纹理贴图(见第11章)。光栅输入设备必须对每个像素进行光照测量，并且(像输出设备一样)它们通常基于传感器阵列获取影像。数码相机是一个二维阵列输入设备，相机中的图像传感器是一种具有光敏像素网格的半导体器件。两种常见的传感器阵列有CCD(电荷耦合器件)和CMOS(互补金属氧化物半导体)。相机的镜头将要拍摄的场景的图像投射到传感器上，然后每个像素测量落在它上面的光能，最终产生一个进入输出图像的数值(图3.7)。就像彩色显示器使用红、绿、蓝子像素一样，大多数彩色相机使用滤色镜阵列或马赛克来让每个像素只看到红、绿或蓝色的光，然后让图像处理软件填补缺失的值，这一过程叫做“去马赛克”（demosaicking）(图3.8)。

<img src="./3. 栅格图像.assets/image-20220908174935317.png" alt="image-20220908174935317" style="zoom:67%;" />

<center>图3.7 数码相机原理</center>

<img src="./3. 栅格图像.assets/image-20220908175433694.png" alt="image-20220908175433694" style="zoom:67%;" />

<center>图3.8 大多数彩色数码相机使用类似”拜耳马赛克“（Bayer mosaic）的滤镜阵列。每个像素用于测量红光、绿光或蓝光。</center>

其他相机（非数码相机）使用三个独立的阵列，或阵列中有三个独立层，在每个像素测量独立的红、绿、蓝的值，生成一个有效的彩色图像，而无需进一步处理。相机的分辨率是由阵列中固定的像素数决定的，通常使用像素总数来表示：具有3000列和2000行像素的相机获取的图像分辨率为3000 × 2000，它有600万像素。重要的是要记住，马赛克传感器不能测量完整的彩色图像，因此，相同像素数的情况下，使用独立的红、绿、蓝测量的相机比使用马赛克传感器的相机能记录更多关于图像的信息。

平板扫描仪也可以测量每个像素网格的红、绿、蓝数值，但与热染料转移打印机一样，它使用的是一维阵列，可以在页面上进行扫描，每秒进行多次测量。整个页面的横向分辨率由阵列的大小决定，而整个页面的分辨率是由测量频率与扫描头移动速度共同决定的。彩色扫描仪有一个3 × $n_x$数组，其中$n_x$是横向的像素数，三行被红色、绿色和蓝色过滤器覆盖。在测量三种颜色的时间之间有一个适当的延迟，这允许在每个网格点进行三次独立的颜色测量。与连续色调打印机一样，扫描仪的分辨率以每英寸像素(ppi)来描述的。

知道了图像来自哪里以及去向何处，现在我们将以我们在图形学算法中使用它们的方式更抽象地讨论图像。



## 3.2 图像、像素和几何图形



我们知道栅格图像是是一个大的像素矩阵，每个像素存储着该格网点的颜色信息。我们也了解了各种输出设备如何处理我们发送给它们的图像，以及输入设备如何从光线反射回来的物理世界中获取图像。但于计算机而言，我们需要对图像抽象化，这种抽象不依赖设备的各种细节，我们可以用它来推论如何产生或说明存在图像中的信息。

当测量或重现图像时，它们以光能的二维分布形式出现：从显示器发出的光是关于显示器表面位置的函数；落在相机图像传感器上的光是关于传感器平面位置上的函数；反射率或光被反射的部分（相对于被吸收的部分）是关于纸张位置的函数。在现实世界中，图像是定义在二维区域（多数是矩形区域）上的函数。因此我们可以把图像抽象成如下函数：
$$
I(x,y) : R → V,
$$
其中R表述一个矩形区域（一个像素的区域），$R⊂ℝ^2$ ；V表示一个像素值集合。最简单的例子是一个理想的灰度图像，矩形中的点只有亮度(没有颜色)，这使我们可以说$V=ℝ^+$（非负实数）。对于一个理想化的彩色图像，每个像素都有红、绿、蓝三个值，此时$V=(ℝ^+)^3$。我们将在下一节讨论V的其它可能取值。

>*译者注：符号 ℝ 表示实数*，$ℝ^2:=\{(x,y) | x,y∈ℝ\}$ ，同理$ℝ^3:=\{(x,y,z) | x,y,z∈ℝ\}$

光栅图像与这个抽象概念有什么关系？接下来看具体例子，一个像素的值，是相机或扫描仪通过测量该像素周围小区域的平均颜色得到的。显示器的一个像素设计为拥有有红、绿、蓝三个子像素，使该像素表面上的图像的平均颜色由光栅图像中相应的像素值控制。